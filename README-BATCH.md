# 魔法AI绘画 - 批量任务系统

基于 Next.js + Tauri 的 AI 图片批量生成应用，支持多种模型并发处理，自动下载和管理生成结果。

## ✨ 核心功能

### 🚀 **批量生成**
- 支持批量创建和处理生图任务
- 文生图、图生图、混合模式
- 灵活的任务配置和参数设置

### ⚡ **并发控制**
- 可配置并发数量（1-10个）
- 智能队列管理
- 实时进度监控

### 🔄 **多模型支持**
- OpenAI (GPT-4, DALL-E)
- Gemini (Google)
- 自定义模型配置
- 模型切换和测试

### 📁 **文件管理**
- 自动下载和本地保存
- 自定义文件名模板
- 按日期/任务组织文件
- 批量下载支持

### 🛡️ **错误处理**
- 完善的错误处理机制
- 自动重试功能
- 失败任务统计和展示

### 📊 **实时监控**
- 任务进度实时显示
- 状态跟踪和统计
- 详细的任务执行日志

## 🏗️ 系统架构

### 核心组件

1. **批量任务管理器** (`BatchTaskManager`)
   - 任务队列管理
   - 并发控制
   - 状态同步

2. **文件下载管理器** (`FileDownloadManager`)
   - 批量下载处理
   - 文件名模板
   - 下载队列管理

3. **存储系统** (`storage.ts`)
   - 本地数据持久化
   - 任务状态保存
   - 配置管理

### 数据结构

```typescript
interface BatchTask {
  id: string
  name: string
  type: TaskType
  status: BatchTaskStatus
  progress: number
  totalItems: number
  completedItems: number
  failedItems: number
  config: BatchTaskConfig
  items: TaskItem[]
  results: TaskResult[]
}
```

## 🚀 使用指南

### 1. 创建批量任务

1. 点击"创建批量任务"按钮
2. 填写任务基本信息：
   - 任务名称
   - 任务类型（文生图/图生图/混合）
3. 配置模型参数：
   - 选择AI模型
   - 设置图片尺寸和比例
   - 配置质量参数
4. 添加提示词：
   - 单个或批量输入
   - 支持文件导入
5. 上传图片（图生图模式）
6. 设置高级参数：
   - 并发数量
   - 重试次数
   - 自动下载选项

### 2. 任务管理

- **开始任务**：点击开始按钮启动批量生成
- **停止任务**：中断正在执行的任务
- **查看详情**：查看任务执行状态和结果
- **删除任务**：清理不需要的任务

### 3. 模型配置

1. 点击"管理模型"按钮
2. 添加新的模型配置：
   - 配置名称
   - 模型类型和具体模型
   - API密钥和基础URL
   - 速率限制和超时设置
3. 测试连接
4. 启用/禁用配置

### 4. 下载设置

1. 点击"下载设置"按钮
2. 配置下载选项：
   - 自动下载开关
   - 文件组织方式
   - 自定义文件名模板
3. 选择快速模板或自定义格式

## 📋 功能特性

### 任务类型

1. **文生图模式**
   - 纯文本生成图片
   - 支持多个提示词
   - 批量处理

2. **图生图模式**
   - 基于上传图片生成新图
   - 支持多张参考图片
   - 保持风格一致性

3. **混合模式**
   - 每个提示词可配对不同图片
   - 灵活的组合方式
   - 批量个性化生成

### 并发控制

- **并发限制**：1-10个任务同时执行
- **智能调度**：根据系统负载自动调整
- **失败重试**：自动重试失败的任务
- **队列管理**：先进先出队列调度

### 文件管理

- **自动下载**：任务完成后自动下载结果
- **文件名模板**：
  - `{task}` - 任务名称
  - `{index}` - 文件索引
  - `{timestamp}` - 时间戳
  - `{date}` - 日期
  - `{taskId}` - 任务ID
- **文件组织**：
  - 按日期分组
  - 按任务分组
  - 自定义目录结构

### 错误处理

- **网络错误**：自动重试，指数退避
- **API限制**：智能等待和重试
- **数据验证**：输入验证和错误提示
- **状态恢复**：页面刷新后状态保持

## 🔧 技术实现

### 前端架构

- **React 19** + **Next.js 15**
- **TypeScript** 类型安全
- **Tailwind CSS** 样式系统
- **Radix UI** 无头组件
- **Tauri** 桌面应用框架

### 核心技术

- **状态管理**：React hooks + Context
- **数据持久化**：localStorage + IndexedDB
- **并发处理**：Promise + 队列管理
- **文件处理**：File API + 下载管理
- **实时更新**：事件驱动架构

### 性能优化

- **代码分割**：按路由分割
- **懒加载**：组件和图片懒加载
- **内存管理**：大文件分块处理
- **缓存策略**：API响应缓存
- **并发限制**：防止过载

## 📊 监控和统计

### 实时监控

- 任务执行进度
- 并发任务数量
- 成功/失败统计
- 平均处理时间

### 历史记录

- 任务执行历史
- 性能统计数据
- 错误日志分析
- 使用情况报告

## 🔒 安全和隐私

- **本地存储**：所有数据存储在本地
- **API密钥**：安全存储和管理
- **数据隔离**：任务数据相互隔离
- **隐私保护**：不上传用户数据到第三方

## 🚀 部署和分发

### 开发环境

```bash
npm install
npm run dev
```

### 生产构建

```bash
npm run build
npm run start
```

### 桌面应用

```bash
npm run tauri:dev    # 开发
npm run desktop      # 构建桌面应用
```

## 📝 更新日志

### v2.0.0 - 批量任务系统
- ✨ 新增批量任务管理功能
- 🚀 支持并发任务处理
- 📁 实现自动文件下载管理
- ⚙️ 添加模型配置系统
- 🛡️ 完善错误处理机制
- 📊 实时进度监控
- 🔄 多模型支持

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

1. Fork 项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🙏 致谢

感谢所有为这个项目做出贡献的开发者！

---

**魔法AI绘画** - 让AI创作变得简单而强大 🚀